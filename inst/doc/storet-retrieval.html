<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Jeffrey D. Walker, PhD" />

<meta name="date" content="2016-02-18" />

<title>Functions for Retrieving MyRWA Data from STORET</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0A%7D%0Apre%20%7B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Functions for Retrieving MyRWA Data from STORET</h1>
<h4 class="author"><em>Jeffrey D. Walker, PhD</em></h4>
<h4 class="date"><em>2016-02-18</em></h4>
</div>


<p>This document describes functions in the <code>myrwaR</code> package for handling STORET data. First, weâ€™ll walk through how to fetch MyRWA data that is currently in STORET. Then we will compare the STORET dataset to what is currently in the Access database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(myrwaR)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)</code></pre></div>
<div id="fetching-data-from-storet" class="section level1">
<h1>Fetching Data from STORET</h1>
<div id="locations-table" class="section level2">
<h2>Locations Table</h2>
<p>The MyRWA locations currently in STORET can be fetched using the <code>storet_locations()</code> function. This function will download a zip file from STORET, unzip the contents, and load the resulting <code>station.csv</code> into a data frame. Note that <code>verbose</code> is optional and <code>TRUE</code> by default, but you can set it to <code>FALSE</code> to suppress the log output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">st_locations &lt;-<span class="st"> </span><span class="kw">storet_locations</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Fetching locations table from STORET...OK
## STORET locations zip file saved to: C:\Users\Jeff\AppData\Local\Temp\Rtmp4u8VKx\storet_stn_f28445a5084.zip 
## STORET locations csv file saved to: C:/Users/Jeff/AppData/Local/Temp/Rtmp4u8VKx/station.csv</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(st_locations)</code></pre></div>
<pre><code>## 'data.frame':    15 obs. of  36 variables:
##  $ OrganizationIdentifier                         : chr  &quot;MYRWA&quot; &quot;MYRWA&quot; &quot;MYRWA&quot; &quot;MYRWA&quot; ...
##  $ OrganizationFormalName                         : chr  &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; ...
##  $ MonitoringLocationIdentifier                   : chr  &quot;MYRWA-ABR006&quot; &quot;MYRWA-ABR028&quot; &quot;MYRWA-ABR049&quot; &quot;MYRWA-ALB006&quot; ...
##  $ MonitoringLocationName                         : chr  &quot;Aberjona River at USGS Gaging Station in Winchester; the bank upstream of weir&quot; &quot;Aberjona River at Washington Street in Winchester; upstream side of the bridge&quot; &quot;Aberjona River at Salem Street in Woburn; downstream side of the bridge&quot; &quot;Alewife Brook at Broadway Bridge in Somerville; downstream of the bridge on the bank&quot; ...
##  $ MonitoringLocationTypeName                     : chr  &quot;River/Stream&quot; &quot;River/Stream&quot; &quot;River/Stream&quot; &quot;River/Stream&quot; ...
##  $ MonitoringLocationDescriptionText              : logi  NA NA NA NA NA NA ...
##  $ HUCEightDigitCode                              : int  1090001 1090001 1090001 1090001 NA NA NA 1090001 1090001 1090001 ...
##  $ DrainageAreaMeasure.MeasureValue               : logi  NA NA NA NA NA NA ...
##  $ DrainageAreaMeasure.MeasureUnitCode            : logi  NA NA NA NA NA NA ...
##  $ ContributingDrainageAreaMeasure.MeasureValue   : logi  NA NA NA NA NA NA ...
##  $ ContributingDrainageAreaMeasure.MeasureUnitCode: logi  NA NA NA NA NA NA ...
##  $ LatitudeMeasure                                : num  42.4 42.5 42.5 42.4 42.4 ...
##  $ LongitudeMeasure                               : num  -71.1 -71.1 -71.1 -71.1 -71 ...
##  $ SourceMapScaleNumeric                          : logi  NA NA NA NA NA NA ...
##  $ HorizontalAccuracyMeasure.MeasureValue         : logi  NA NA NA NA NA NA ...
##  $ HorizontalAccuracyMeasure.MeasureUnitCode      : logi  NA NA NA NA NA NA ...
##  $ HorizontalCollectionMethodName                 : chr  &quot;GPS-Unspecified&quot; &quot;GPS-Unspecified&quot; &quot;GPS-Unspecified&quot; &quot;GPS-Unspecified&quot; ...
##  $ HorizontalCoordinateReferenceSystemDatumName   : chr  &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; ...
##  $ VerticalMeasure.MeasureValue                   : logi  NA NA NA NA NA NA ...
##  $ VerticalMeasure.MeasureUnitCode                : logi  NA NA NA NA NA NA ...
##  $ VerticalAccuracyMeasure.MeasureValue           : logi  NA NA NA NA NA NA ...
##  $ VerticalAccuracyMeasure.MeasureUnitCode        : logi  NA NA NA NA NA NA ...
##  $ VerticalCollectionMethodName                   : logi  NA NA NA NA NA NA ...
##  $ VerticalCoordinateReferenceSystemDatumName     : logi  NA NA NA NA NA NA ...
##  $ CountryCode                                    : chr  &quot;US&quot; &quot;US&quot; &quot;US&quot; &quot;US&quot; ...
##  $ StateCode                                      : int  25 25 25 25 25 25 25 25 25 25 ...
##  $ CountyCode                                     : int  17 17 17 17 25 25 17 17 17 25 ...
##  $ AquiferName                                    : logi  NA NA NA NA NA NA ...
##  $ FormationTypeText                              : logi  NA NA NA NA NA NA ...
##  $ AquiferTypeName                                : logi  NA NA NA NA NA NA ...
##  $ ConstructionDateText                           : logi  NA NA NA NA NA NA ...
##  $ WellDepthMeasure.MeasureValue                  : logi  NA NA NA NA NA NA ...
##  $ WellDepthMeasure.MeasureUnitCode               : logi  NA NA NA NA NA NA ...
##  $ WellHoleDepthMeasure.MeasureValue              : logi  NA NA NA NA NA NA ...
##  $ WellHoleDepthMeasure.MeasureUnitCode           : logi  NA NA NA NA NA NA ...
##  $ ProviderName                                   : chr  &quot;STORET&quot; &quot;STORET&quot; &quot;STORET&quot; &quot;STORET&quot; ...</code></pre>
</div>
<div id="results-table" class="section level2">
<h2>Results Table</h2>
<p>The MyRWA results table currently in STORET can be fetched using the <code>storet_results()</code> function. This function will download a zip file from STORET, unzip the contents, and load the resulting <code>results.csv</code> into a data frame. Note that the <code>verbose</code> argument can be used here too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">st_results &lt;-<span class="st"> </span><span class="kw">storet_results</span>()</code></pre></div>
<pre><code>## Fetching results table from STORET...OK
## STORET results zip file saved to: C:\Users\Jeff\AppData\Local\Temp\Rtmp4u8VKx\storet_results_f2832b03edb.zip 
## STORET results csv file saved to: C:/Users/Jeff/AppData/Local/Temp/Rtmp4u8VKx/result.csv</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(st_results)</code></pre></div>
<pre><code>## 'data.frame':    20686 obs. of  63 variables:
##  $ OrganizationIdentifier                           : chr  &quot;MYRWA&quot; &quot;MYRWA&quot; &quot;MYRWA&quot; &quot;MYRWA&quot; ...
##  $ OrganizationFormalName                           : chr  &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; &quot;Mystic River Watershed Association (Massachusetts)&quot; ...
##  $ ActivityIdentifier                               : chr  &quot;MYRWA-BEI093:201305280646:F:S&quot; &quot;MYRWA-MIC004:201306270700:L:S&quot; &quot;MYRWA-BEI093:201307250657:L:S&quot; &quot;MYRWA-MIC004:201307250706:F:S&quot; ...
##  $ ActivityTypeCode                                 : chr  &quot;Field Msr/Obs&quot; &quot;Sample-Routine&quot; &quot;Sample-Routine&quot; &quot;Field Msr/Obs&quot; ...
##  $ ActivityMediaName                                : chr  &quot;Water&quot; &quot;Water&quot; &quot;Water&quot; &quot;Water&quot; ...
##  $ ActivityMediaSubdivisionName                     : logi  NA NA NA NA NA NA ...
##  $ ActivityStartDate                                : Date, format: &quot;2013-05-28&quot; &quot;2013-06-27&quot; ...
##  $ ActivityStartTime.Time                           : chr  &quot;05:46:00&quot; &quot;06:00:00&quot; &quot;05:57:00&quot; &quot;06:06:00&quot; ...
##  $ ActivityStartTime.TimeZoneCode                   : chr  &quot;EST&quot; &quot;EST&quot; &quot;EST&quot; &quot;EST&quot; ...
##  $ ActivityEndDate                                  : logi  NA NA NA NA NA NA ...
##  $ ActivityEndTime.Time                             : logi  NA NA NA NA NA NA ...
##  $ ActivityEndTime.TimeZoneCode                     : logi  NA NA NA NA NA NA ...
##  $ ActivityDepthHeightMeasure.MeasureValue          : logi  NA NA NA NA NA NA ...
##  $ ActivityDepthHeightMeasure.MeasureUnitCode       : logi  NA NA NA NA NA NA ...
##  $ ActivityDepthAltitudeReferencePointText          : logi  NA NA NA NA NA NA ...
##  $ ActivityTopDepthHeightMeasure.MeasureValue       : logi  NA NA NA NA NA NA ...
##  $ ActivityTopDepthHeightMeasure.MeasureUnitCode    : logi  NA NA NA NA NA NA ...
##  $ ActivityBottomDepthHeightMeasure.MeasureValue    : logi  NA NA NA NA NA NA ...
##  $ ActivityBottomDepthHeightMeasure.MeasureUnitCode : logi  NA NA NA NA NA NA ...
##  $ ProjectIdentifier                                : chr  &quot;BASE&quot; &quot;BASE&quot; &quot;BASE&quot; &quot;BASE&quot; ...
##  $ ActivityConductingOrganizationText               : logi  NA NA NA NA NA NA ...
##  $ MonitoringLocationIdentifier                     : chr  &quot;MYRWA-BEI093&quot; &quot;MYRWA-MIC004&quot; &quot;MYRWA-BEI093&quot; &quot;MYRWA-MIC004&quot; ...
##  $ ActivityCommentText                              : logi  NA NA NA NA NA NA ...
##  $ SampleAquifer                                    : logi  NA NA NA NA NA NA ...
##  $ HydrologicCondition                              : logi  NA NA NA NA NA NA ...
##  $ HydrologicEvent                                  : logi  NA NA NA NA NA NA ...
##  $ SampleCollectionMethod.MethodIdentifier          : chr  &quot;USEPA&quot; &quot;grab&quot; &quot;grab&quot; &quot;USEPA&quot; ...
##  $ SampleCollectionMethod.MethodIdentifierContext   : chr  &quot;USEPA&quot; &quot;MYRWA&quot; &quot;MYRWA&quot; &quot;USEPA&quot; ...
##  $ SampleCollectionMethod.MethodName                : chr  &quot;USEPA&quot; &quot;Grab Sample&quot; &quot;Grab Sample&quot; &quot;USEPA&quot; ...
##  $ SampleCollectionEquipmentName                    : chr  &quot;Unknown&quot; &quot;Water Bottle&quot; &quot;Water Bottle&quot; &quot;Unknown&quot; ...
##  $ ResultDetectionConditionText                     : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ CharacteristicName                               : chr  &quot;Temperature, water&quot; &quot;Dissolved oxygen (DO)&quot; &quot;Total suspended solids&quot; &quot;Temperature, water&quot; ...
##  $ ResultSampleFractionText                         : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ ResultMeasureValue                               : num  13.7 40.9 200 19.5 10.6 ...
##  $ ResultMeasure.MeasureUnitCode                    : chr  &quot;deg C&quot; &quot;%&quot; &quot;mg/l&quot; &quot;deg C&quot; ...
##  $ MeasureQualifierCode                             : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ ResultStatusIdentifier                           : chr  &quot;Final&quot; &quot;Final&quot; &quot;Final&quot; &quot;Final&quot; ...
##  $ StatisticalBaseCode                              : logi  NA NA NA NA NA NA ...
##  $ ResultValueTypeName                              : chr  &quot;Actual&quot; &quot;Calculated&quot; &quot;Actual&quot; &quot;Actual&quot; ...
##  $ ResultWeightBasisText                            : logi  NA NA NA NA NA NA ...
##  $ ResultTimeBasisText                              : logi  NA NA NA NA NA NA ...
##  $ ResultTemperatureBasisText                       : logi  NA NA NA NA NA NA ...
##  $ ResultParticleSizeBasisText                      : logi  NA NA NA NA NA NA ...
##  $ PrecisionValue                                   : logi  NA NA NA NA NA NA ...
##  $ ResultCommentText                                : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ USGSPCode                                        : logi  NA NA NA NA NA NA ...
##  $ ResultDepthHeightMeasure.MeasureValue            : logi  NA NA NA NA NA NA ...
##  $ ResultDepthHeightMeasure.MeasureUnitCode         : logi  NA NA NA NA NA NA ...
##  $ ResultDepthAltitudeReferencePointText            : logi  NA NA NA NA NA NA ...
##  $ SubjectTaxonomicName                             : logi  NA NA NA NA NA NA ...
##  $ SampleTissueAnatomyName                          : logi  NA NA NA NA NA NA ...
##  $ ResultAnalyticalMethod.MethodIdentifier          : chr  &quot;170.1&quot; &quot;360.2&quot; &quot;2540-D&quot; &quot;170.1&quot; ...
##  $ ResultAnalyticalMethod.MethodIdentifierContext   : chr  &quot;USEPA&quot; &quot;USEPA&quot; &quot;APHA&quot; &quot;USEPA&quot; ...
##  $ ResultAnalyticalMethod.MethodName                : chr  &quot;Temperature&quot; &quot;Dissolved Oxygen by Winkler Technique&quot; &quot;Total Suspended Solids in Water&quot; &quot;Temperature&quot; ...
##  $ MethodDescriptionText                            : chr  &quot;https://www.nemi.gov/methods/method_summary/5216/&quot; &quot;https://www.nemi.gov/methods/method_summary/5253/&quot; &quot;https://www.nemi.gov/methods/method_summary/9819/&quot; &quot;https://www.nemi.gov/methods/method_summary/5216/&quot; ...
##  $ LaboratoryName                                   : logi  NA NA NA NA NA NA ...
##  $ AnalysisStartDate                                : logi  NA NA NA NA NA NA ...
##  $ ResultLaboratoryCommentText                      : logi  NA NA NA NA NA NA ...
##  $ DetectionQuantitationLimitTypeName               : logi  NA NA NA NA NA NA ...
##  $ DetectionQuantitationLimitMeasure.MeasureValue   : logi  NA NA NA NA NA NA ...
##  $ DetectionQuantitationLimitMeasure.MeasureUnitCode: logi  NA NA NA NA NA NA ...
##  $ PreparationStartDate                             : logi  NA NA NA NA NA NA ...
##  $ ProviderName                                     : chr  &quot;STORET&quot; &quot;STORET&quot; &quot;STORET&quot; &quot;STORET&quot; ...</code></pre>
</div>
</div>
<div id="comparing-storet-data-to-myrwa-database" class="section level1">
<h1>Comparing STORET Data to MyRWA Database</h1>
<p>This section compares the number of samples by different variables (e.g.Â location, characteristic, year) between STORET and the current water quality database.</p>
<p>First, we need to extract the dataset from the current database using the function <code>wqx_results()</code> (this will convert the dataset to WQX format, which is similar, though not identical, to the format provided by STORET):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ch &lt;-<span class="st"> </span><span class="kw">db_connect</span>(<span class="st">&quot;D:/Dropbox/Work/mystic/db/MysticDB_20160208.accdb&quot;</span>)
db_results &lt;-<span class="st"> </span><span class="kw">wqx_results</span>(ch, <span class="dt">projects=</span><span class="st">'BASE'</span>)
<span class="kw">close</span>(ch)</code></pre></div>
<p>Next, weâ€™ll convert the <code>ActivityStartDate</code> column in the <code>db_results</code> data frame to <code>Date</code> types, and then filter for database samples that are within the range of dates in the STORET dataset (in case there are some sample dates that have been added to the database but not yet uploaded to STORET).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db_results &lt;-<span class="st"> </span><span class="kw">mutate</span>(db_results,
                     <span class="dt">ActivityStartDate    =</span> <span class="kw">as.Date</span>(ActivityStartDate),
                     <span class="dt">MonitoringLocationID =</span> <span class="kw">paste</span>(<span class="st">&quot;MYRWA&quot;</span>, MonitoringLocationID, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(ActivityStartDate &gt;=<span class="st"> </span><span class="kw">min</span>(st_results$ActivityStartDate),
         ActivityStartDate &lt;=<span class="st"> </span><span class="kw">max</span>(st_results$ActivityStartDate))</code></pre></div>
<div id="compare-sample-counts" class="section level2">
<h2>Compare Sample Counts</h2>
<p>To compare the STORET dataset to that in the current database, we can use the <code>storet_compare_count()</code> function. This function takes one column from each dataset, counts the number of samples for each unique value, and then compares those counts between the two.</p>
<div id="by-location-id" class="section level3">
<h3>By Location ID</h3>
<p>First, letâ€™s compare the number of samples by Location ID:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">storet_compare_count</span>(<span class="dt">storet =</span> st_results$MonitoringLocationIdentifier,
                     <span class="dt">db     =</span> db_results$MonitoringLocationID,
                     <span class="dt">name   =</span> <span class="st">&quot;LocationID&quot;</span>)</code></pre></div>
<pre><code>## Sample counts by LocationID are different!
## 
##    LocationID  DB STORET STORET-DB
##  MYRWA-BEI001  46      0       -46
##  MYRWA-BEI093 607    615         8
##  MYRWA-CHR95S 744    706       -38
##  MYRWA-MIC004 734    702       -32
##  MYRWA-MYR275 676    636       -40
##  MYRWA-MYRMMP 767    727       -40</code></pre>
</div>
<div id="by-characteristic-name" class="section level3">
<h3>By Characteristic Name</h3>
<p>Next, letâ€™s compare the number of samples by Characteristic Name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">storet_compare_count</span>(<span class="dt">storet =</span> st_results$CharacteristicName,
                     <span class="dt">db     =</span> db_results$CharacteristicName,
                     <span class="dt">name   =</span> <span class="st">&quot;CharacteristicName&quot;</span>)</code></pre></div>
<pre><code>## Sample counts by CharacteristicName are different!
## 
##                        CharacteristicName   DB STORET STORET-DB
##                     Dissolved oxygen (DO) 4680   4635       -45
##                              Enterococcus  380    356       -24
##  Inorganic nitrogen (nitrate and nitrite) 2399   2375       -24
##                                Phosphorus 2503   2479       -24
##                      Specific conductance 2444   2420       -24
##                        Temperature, water 2397   2374       -23
##                    Total suspended solids 2458   2434       -24</code></pre>
</div>
<div id="by-year" class="section level3">
<h3>By Year</h3>
<p>And then, weâ€™ll compare counts by Year:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">storet_compare_count</span>(<span class="dt">storet =</span> <span class="kw">year</span>(st_results$ActivityStartDate),
                     <span class="dt">db     =</span> <span class="kw">year</span>(db_results$ActivityStartDate),
                     <span class="dt">name   =</span> <span class="st">&quot;Year&quot;</span>)</code></pre></div>
<pre><code>## Sample counts by Year are different!
## 
##  Year  DB STORET STORET-DB
##  2015 822    634      -188</code></pre>
</div>
<div id="by-date" class="section level3">
<h3>By Date</h3>
<p>Finally, weâ€™ll compare counts by Date:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">storet_compare_count</span>(<span class="dt">storet =</span> st_results$ActivityStartDate,
                     <span class="dt">db     =</span> db_results$ActivityStartDate,
                     <span class="dt">name   =</span> <span class="st">&quot;Date&quot;</span>)</code></pre></div>
<pre><code>## Sample counts by Date are different!
## 
##        Date DB STORET STORET-DB
##  2015-03-10 46      0       -46
##  2015-04-08 46      0       -46
##  2015-05-08 48      0       -48
##  2015-06-05 48      0       -48</code></pre>
</div>
<div id="summary" class="section level3">
<h3>Summary</h3>
<p>These comparisons reveal that there are four baseline dates in the database that are not in yet STORET. This approach can thus be a useful tool for figuring out which sample events should be exported for the next STORET upload.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
